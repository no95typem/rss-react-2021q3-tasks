(()=>{var e={114:()=>{},516:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=n.p+"assets/img/527a47952219a8b48cb8f8965516ec60.png"},473:e=>{"use strict";e.exports=require("body-parser")},747:e=>{"use strict";e.exports=require("fs")},622:e=>{"use strict";e.exports=require("path")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{"use strict";require("core-js/stable"),require("regenerator-runtime/runtime");const e=require("react"),t=require("react-dom/server"),r=require("express"),o=require("react-router"),a=require("redux"),i=require("react-redux");function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t,n=1;n<arguments.length;n++)t=null==arguments[n]?{}:arguments[n],n%2?c(Object(t),!0).forEach((function(n){u(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}));return e}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=new function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),u(this,"deepFreeze",(function(e){if("object"===l(e)&&null!==e){var n=e;return Object.keys(n).forEach((function(e){"object"!==l(n[e])||Object.isFrozen(n[e])||t.deepFreeze(n[e])})),Object.freeze(e)}throw new Error("not object")})),u(this,"deepClone",(function(e){if(Array.isArray(e)){var n=[];return e.forEach((function(e){n.push(e)})),n.map((function(e){return t.deepClone(e)}))}if("object"===l(e)&&null!==e){if(e instanceof Date)return new Date(e.getTime());if(e instanceof HTMLElement)return e.cloneNode(!0);if(e instanceof Blob)return e.slice();var r=s({},e);return Object.keys(r).forEach((function(e){r[e]=t.deepClone(r[e])})),Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}return e})),u(this,"deepCloneForWebworker",(function(e){if(Array.isArray(e)){var n=[];return e.forEach((function(e){n.push(e)})),n.map((function(e){return t.deepCloneForWebworker(e)}))}if("object"===l(e)&&null!==e){var r=s({},e);return Object.keys(r).forEach((function(e){r[e]=t.deepCloneForWebworker(r[e])})),r}return e}))};function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}d.deepFreeze(d);var h=d.deepFreeze(new function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),f(this,"general","general"),f(this,"anime","anime"),f(this,"people","people")});function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=d.deepFreeze(new function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),p(this,"sfw","sfw"),p(this,"sketchy","sketchy"),p(this,"nsfw","nsfw")});function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=d.deepFreeze(new function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),y(this,"date_added","date_added"),y(this,"relevance","relevance"),y(this,"random"," random"),y(this,"views"," views"),y(this,"favorites","favorites"),y(this,"toplist","toplist")});var b=d.deepFreeze(new function e(t,n,r,o,a,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.q=t,this.categories=n,this.purity=r,this.sorting=o,this.page=a,this.apiKey=i}("",[h.general],[v.sfw],m.date_added,1)),g="/proxy",j={query:b,dataMap:{},paginationData:void 0,contentScrollTop:0,flags:{fetching:!1,error:!1,searchPerformed:!1,end:!0}},x={data:void 0,flags:{dataLoaded:void 0,imgPreloaded:void 0}};function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;w(this,e),O(this,"timestamps",[]),this.throttler=t,this.throttlerTimeWindow=n}return function(e,t,n){t&&S(e.prototype,t),n&&S(e,n)}(e,[{key:"do",value:function(e){var t=this;return new Promise((function(n,r){var o={action:e,res:n,rej:r,number:0};t.lastQueued?(t.lastQueued.next=o,o.number=t.lastQueued.number+1,t.lastQueued=o):(t.lastQueued=o,t.processItem(o))}))}},{key:"throttleReq",value:function(){var e=this;return this.throttler?new Promise((function(t){var n=Date.now();e.timestamps.push(n);var r=n-e.throttlerTimeWindow;e.timestamps=e.timestamps.filter((function(e){return e>r})),e.throttler(e.timestamps.length,e.timestamps[0]||0).then((function(){return t()}))})):Promise.resolve()}},{key:"processItem",value:function(e){var t=this;this.throttleReq().then((function(){e.action().then((function(t){return e.res(t)})).catch((function(t){return e.rej(t)})).finally((function(){e.next?t.processItem(e.next):t.lastQueued=void 0}))}))}}]),e}();function N(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function A(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){function a(e){N(c,r,o,a,i,"next",e)}function i(e){N(c,r,o,a,i,"throw",e)}var c=e.apply(t,n);a(void 0)}))}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E={apiKey:void 0,imgFetcher:new function e(t,n){var r=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),C(this,"IMG_LOAD_QUEUE_MANAGER",new P(function(){var e=A(regeneratorRuntime.mark((function e(t,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t>=r.REQ_PER_WINDOW?r.WINDOW-(Date.now()-n):0,e.next=3,new Promise((function(e){return setTimeout(e,o)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.WINDOW)),C(this,"loadImg",(function(e){var t=function(){var t=A(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",!1);case 2:return t.abrupt("return",new Promise((function(t){var n=new Image;n.onload=function(){return t(!0)},n.onerror=function(){return t(!1)},n.referrerPolicy="no-referrer",n.src=e})));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return r.IMG_LOAD_QUEUE_MANAGER.do(t)})),this.REQ_PER_WINDOW=t,this.WINDOW=n}(700,6e4)};const _=require("react-router-dom"),T=require("react-transition-group"),k="MKu2YWXstrQJ1Z3-dKL12",I="_3vUfVlSwXwWoTOSNe9YGht",R=require("react/jsx-runtime");var L,D,F=function(){return(0,R.jsxs)("section",{className:k,children:[(0,R.jsx)("h2",{children:"About"}),(0,R.jsxs)("article",{className:I,children:[(0,R.jsx)("p",{children:"This is my small project for Rolling Scopes School: React 2021 Q3."}),(0,R.jsxs)("section",{children:[(0,R.jsx)("p",{children:"In the project I learned React basics:"}),(0,R.jsxs)("ul",{children:[(0,R.jsx)("li",{children:"React components (FC and CC)"}),(0,R.jsx)("li",{children:"React state, hooks, lifecycle, a data flow pattern"}),(0,R.jsx)("li",{children:"React router"}),(0,R.jsx)("li",{children:"React transition group"}),(0,R.jsx)("li",{children:"React + Redux + thunk"}),(0,R.jsx)("li",{children:"React + Jest + React testing library"})]})]}),(0,R.jsx)("section",{children:(0,R.jsxs)("p",{children:["The project uses ",(0,R.jsx)("a",{href:"https://wallhaven.cc",children:"Wallhaven"})," API. It is tricky because server responses do not have some essential headers. Therefore app need a cors proxy server."]})}),(0,R.jsxs)("section",{children:[(0,R.jsx)("p",{children:"The project written and builded with usage of:"}),(0,R.jsxs)("ul",{children:[(0,R.jsx)("li",{children:"React"}),(0,R.jsx)("li",{children:"Redux + thunk"}),(0,R.jsx)("li",{children:"Bootstrap CSS and icons"}),(0,R.jsx)("li",{children:"Typescript"}),(0,R.jsx)("li",{children:"Webpack 5"})]})]}),(0,R.jsx)("p",{children:"You can find more at my github repo."})]})]})},q=function(){return(0,R.jsx)("section",{children:(0,R.jsx)("h2",{children:"404: Not found"})})},W=n(114),M=function(e,t){return{type:W.Actions.DETAILS_PAGE_SET_FLAG,payload:{key:e,val:t}}};(D=L||(L={}))[D.WHSearch=0]="WHSearch",D[D.WHWpInfo=1]="WHWpInfo";var z=function(e){return function(t,n){var r=n().coreState,o=r.apiKey,a=r.imgFetcher;fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:L.WHWpInfo,id:e,apiKey:o})}).then((function(e){if(e.ok)return e.json();throw new Error("")})).then((function(e){var n=e.data;t(function(e){return{type:W.Actions.DETAILS_PAGE_SET_DATA,payload:e}}(n)),a.loadImg(n.path).then((function(e){t(M("imgPreloaded",e))})),t(M("dataLoaded",!0))})).catch((function(){t(M("dataLoaded",!1))}))}},K=function(){return{type:W.Actions.DETAILS_PAGE_RESET}};function U(e){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var H=function(e){return(0,R.jsxs)("table",{className:"table",children:[(0,R.jsx)("thead",{children:(0,R.jsx)("tr",{children:(0,R.jsx)("th",{colSpan:9999,children:e.header})})}),(0,R.jsx)("tbody",{children:Object.entries(e.obj).map((function(e){var t=G(e,2),n=t[0],r=t[1];return"object"===U(r)&&null!==r?(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:9999,children:H({obj:r,header:n})})},n):(0,R.jsxs)("tr",{children:[(0,R.jsx)("th",{scope:"col",children:n}),(0,R.jsx)("th",{scope:"col",children:r})]},n)}))})]})},B=function(){return(0,R.jsx)("div",{className:"spinner-border text-light",role:"status",children:(0,R.jsx)("span",{className:"visually-hidden",children:"Loading..."})})},Y=function(){return(0,R.jsx)("div",{className:"spinner-grow text-light",role:"status",children:(0,R.jsx)("span",{className:"visually-hidden",children:"Loading..."})})};const X="_2ipSUfV-4BIzPS6WOMDYPg",J="Fp06vNgioy9buCDlGdsxa",V="_1W9wIWfyrVDFxDbzHsr0ix",Z="_2Oe67rCIiPAxMAxs2DtXCb";function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t,n=1;n<arguments.length;n++)t=null==arguments[n]?{}:arguments[n],n%2?$(Object(t),!0).forEach((function(n){te(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}));return e}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ne=(0,i.connect)((function(e){return{detailsPageState:e.detailsPageState}}),(function(e){return(0,a.bindActionCreators)({fetchById:z,resetDetailsPageState:K},e)}))((function(t){var n=t.detailsPageState,r=n.flags,o=n.data,a=(0,_.useParams)(),i=(0,_.useHistory)();e.useEffect((function(){return t.fetchById(a.id),function(){t.resetDetailsPageState()}}),[a.id]);var c=void 0===r.dataLoaded?(0,R.jsx)(B,{}):!1===r.dataLoaded||!1===r.imgPreloaded?(0,R.jsx)("div",{className:"alert alert-error",role:"alert",children:"Failed to load image"}):r.imgPreloaded?(0,R.jsx)("img",{src:null===o||void 0===o?void 0:o.path}):(0,R.jsx)(Y,{});return(0,R.jsxs)("section",{className:X,children:[(0,R.jsx)("aside",{className:"".concat(J," table-responsive table-sm"),children:(0,R.jsx)(H,ee({},{obj:o||{},header:"INFO"}))}),(0,R.jsxs)("div",{className:V,children:[c,(0,R.jsx)("button",{className:"".concat(Z," btn btn-secondary"),onClick:function(){return i.goBack()},children:"Back to search"})]})]})}));const re="_20nxk27raIoQOMCaRqzCMI",oe="_1XJfMn_82ysnUdovTymyQ",ae="_1Kg3rK0PBZc56Lq-tD6YRo",ie="_3zQSOu0GtMHwzUmLb_mk5i",ce="ECmgixBmO0TAH4lQzAetf";var se=function(e){return{type:W.Actions.GALLERY_SET_QUERY,payload:e}};const le=require("react-dom");function ue(){return function(){var e;return null!==(e=window.crypto)&&void 0!==e&&e.getRandomValues?window.crypto.getRandomValues(new Uint8Array(4)).join(""):Array(8).fill(null).map((function(){return(10*Math.random()).toFixed(0)})).join("")}()}var de=function(t){var n=document.body,r=document.createElement("div");return e.useEffect((function(){return n.append(r),function(){return r.remove()}}),[]),le.createPortal((0,R.jsx)("div",{className:"modal fade show ".concat(t.classNameStr||""),id:t.id,tabIndex:-1,"aria-labelledby":t.ariaLabel,style:{display:"block"},onClick:function(){return t.onClose()},role:"dialog",children:(0,R.jsx)("div",{className:"modal-dialog",onClick:function(e){return e.stopPropagation()},children:(0,R.jsxs)("div",{className:"modal-content",children:[(0,R.jsxs)("div",{className:"modal-header",children:[(0,R.jsx)("h5",{className:"modal-title",children:t.title}),(0,R.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:function(){return t.onClose()},role:"button"})]}),(0,R.jsx)("div",{className:"modal-body",children:t.body}),(0,R.jsxs)("div",{className:"modal-footer",children:[(0,R.jsx)("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",onClick:function(){return t.onClose()},role:"button",children:"Close"}),(0,R.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(){return t.onOk()},role:"button",children:t.btnText})]})]})})}),r)};function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e){for(var t,n=1;n<arguments.length;n++)t=null==arguments[n]?{}:arguments[n],n%2?fe(Object(t),!0).forEach((function(n){pe(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}));return e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ve=function(e,t,n){var r=d.deepClone(e);if("q"===t)r[t]=n;else if("categories"===t)r[t]=n;else if("purity"===t)!n.includes("nsfw")||e.apiKey&&""!==e.apiKey?r[t]=n:function(){var e=document.createElement("div"),t=function(){le.render((0,R.jsx)(R.Fragment,{}),e),e.remove()},n=(0,R.jsx)(de,{classNameStr:"animate__animated animate__fadeIn",id:ue(),ariaLabel:"Settings change error",title:"Settings change error",body:"Wallhaven requires API key for NSFW content! Copy your API key and enter it first! DO NOT FORGET TO ALLOW NSFW IN RESULTS IN ACCOUNT SETTINGS!",btnText:"Go to settings",onClose:function(){return t()},onOk:function(){t();var e=document.createElement("a");e.href="https://wallhaven.cc/settings/account",e.target="_blank",e.referrerPolicy="noreferrer",e.click()}});le.render(n,e)}();else if("sorting"===t)r[t]=n;else if("page"===t){var o=Number.parseInt("".concat(n),10);Number.isNaN(o)||(r[t]=o)}else"apiKey"===t&&(r[t]=n,""===n&&e.purity.includes("nsfw")&&(r.purity=e.purity.filter((function(e){return"nsfw"!==e}))));return r},ye=function(e){return new Promise((function(t,n){var r=function(e){var t=e.q,n=function(e){var t=e.categories.includes("general")?1:0,n=e.categories.includes("anime")?1:0,r=e.categories.includes("people")?1:0;return"".concat(t).concat(n).concat(r)}(e),r=function(e){var t=e.purity.includes("sfw")?1:0,n=e.purity.includes("sketchy")?1:0,r=e.purity.includes("nsfw")?1:0;return"".concat(t).concat(n).concat(r)}(e),o="&categories=".concat(n,"&purity=").concat(r),a=e.apiKey?"&apikey=".concat(e.apiKey):"",i="&page=".concat(e.page);return"search?q=".concat(t).concat(o,"&sorting=").concat(e.sorting).concat(i).concat(a)}(e);fetch(g,he(he({},undefined),{},{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:L.WHSearch,fetchStr:r})})).then((function(e){if(e.ok)return e.json();throw new Error("x")})).then((function(e){var n=e,r={};n.data.forEach((function(e){r[e.id]=e}));var o={current_page:n.meta.current_page,last_page:n.meta.last_page,total:n.meta.total,per_page:n.meta.per_page};t([r,o])})).catch((function(e){return n(e)}))}))},me=function(e){return{type:W.Actions.GALLERY_SET_DATA,payload:e}},be=function(e,t){return{type:W.Actions.GALLERY_SET_FLAG,payload:{key:e,val:t}}},ge=function(e){return{type:W.Actions.GALLERY_SET_PAGINATION,payload:e}};function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t,n=1;n<arguments.length;n++)t=null==arguments[n]?{}:arguments[n],n%2?je(Object(t),!0).forEach((function(n){we(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):je(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}));return e}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Oe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Pe(e,t,n,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function Ne(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){function a(e){Pe(c,r,o,a,i,"next",e)}function i(e){Pe(c,r,o,a,i,"throw",e)}var c=e.apply(t,n);a(void 0)}))}}var Ae=function(e){return e},Ce=function(){var e=Ne(regeneratorRuntime.mark((function e(t,n){var r,o,a,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(t);case 2:return r=e.sent,o=Se(r,2),a=o[0],i=o[1],c=Object.entries(a).map((function(e){return new Promise((function(t){e[1].thumbs.small?n(e[1].thumbs.small).then((function(n){t([e[1].id,Ae(n)])})):t([e[1].id,Ae(!1)])}))})),e.abrupt("return",{data:a,loads:c,pagination:i});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=function(e,t){return function(n,r){var o=r(),a=o.coreState.imgFetcher.loadImg,i=o.galleryState.flags,c=t||o.galleryState.query;i.fetching||e&&i.end||(n(be("error",!1)),n(be("fetching",!0)),n(be("searchPerformed",!0)),e?c.page++:(n(be("end",!1)),n(me({}))),Ce(c,a).then(function(){var t=Ne(regeneratorRuntime.mark((function t(a){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=e?xe(xe({},o.galleryState.dataMap),a.data):a.data,n(me(i)),n(ge(a.pagination)),n(be("fetching",!1)),(0===a.loads.length||a.pagination.last_page===a.pagination.current_page)&&n(be("end",!0)),a.loads.forEach((function(e){e.then((function(e){var t=Se(e,2),o=t[0],a=t[1],i=r().galleryState;i.dataMap[o]&&(i.dataMap[o].loadSuccess=a,n(me(i.dataMap)))}))}));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()).catch((function(){n(be("fetching",!1)),n(be("end",!0)),n(be("error",!0))})))}},_e=function(e){return{type:W.Actions.GALLERY_SET_CONTENT_SCROLL_TOP,payload:e}},Te=function(e){return{type:W.Actions.CORE_SET_API_KEY,payload:e}};const ke="vxTsoN8CBwcmhUrUuuIpL";var Ie=function(e){return(0,R.jsxs)("div",{className:ke,role:"status",children:[(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:e.color||"red",viewBox:"0 0 16 16",width:e.size||"50%",height:e.size||"50%",children:(0,R.jsx)("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"})}),(0,R.jsx)("span",{children:e.text})]})};const Re="_3PuaPu4R1qfCqyo6ZxG1z8";var Le=function(){return(0,R.jsx)("div",{className:Re})};const De="hpADCA_u6ByhFe3eUE4np",Fe="sTplLDxN8N8RSiX-Hm5No",qe="_3PLYaeN9ff0CajZ8RvGx3N",We="_2eAVE3-Vj7Ha40M_L7PRD_",Me="_30XHoCw1lsxYi7WsCBLsba",ze="_3HuZetPlbdnXKCfklN3CDj";const Ke=function(e){var t=(0,o.useHistory)();switch(e.data.loadSuccess){case void 0:return(0,R.jsx)(Le,{});case!0:return(0,R.jsx)("div",{className:ze,"data-testid":"content-img",children:(0,R.jsx)("img",{className:Me,src:e.data.thumbs.small,alt:"",width:"100%",onClick:function(){t.push("/details/".concat(e.data.id))},role:"img"})});case!1:default:return(0,R.jsx)("div",{"data-testid":"content-img",className:ze,children:(0,R.jsx)(Ie,{size:"30%",text:"Failed to load the image",color:"rgba(190, 0, 0, 0.5)"})})}};var Ue=function(t){var n=e.useRef(null),r=e.useRef(null);e.useEffect((function(){var e=n.current;return e?(t.scrollTop&&(e.scrollTop=t.scrollTop),e.onscroll=function(){var n,o,a;null===(n=t.onScroll)||void 0===n||n.call(t,e.scrollTop);var i=null===(o=r.current)||void 0===o?void 0:o.getBoundingClientRect(),c=window.innerHeight;i&&(null===i||void 0===i?void 0:i.top)<c&&(null===(a=t.onScrollEnd)||void 0===a||a.call(t))},function(){e.onscroll=null}):void 0}),[]);var o,a=Object.values(t.memory),i=a.some((function(e){return void 0!==e.loadSuccess}));return o=t.error?(0,R.jsx)("div",{className:"alert alert-danger",role:"alert",children:"Fetching error!"}):!i&&t.fetching?(0,R.jsx)("div",{className:We,children:(0,R.jsx)(B,{})}):0<a.length?a.map((function(e){return(0,R.jsx)("article",{children:(0,R.jsx)(Ke,{data:e})},e.id)})):t.searchPerformed?(0,R.jsx)("div",{className:"alert alert-light",role:"alert",children:"Found nothing"}):(0,R.jsxs)("div",{className:"info info-primary d-flex align-items-center",role:"contentinfo",style:{gap:"10px"},children:[(0,R.jsx)("div",{children:(0,R.jsx)("i",{className:"bi-search"})}),(0,R.jsx)("div",{children:"Try to search anything!"})]}),(0,R.jsx)("div",{className:De,ref:n,role:"grid",children:t.error||0===a.length?o:(0,R.jsxs)("div",{className:Fe,children:[o,t.end||t.fetching&&0===a.length?void 0:(0,R.jsx)("div",{className:"".concat(qe," ").concat(We),ref:r,children:(0,R.jsx)(B,{})})]})})};const Ge="KUwDQ7O-sB08SgJCv6JUG",Qe="_3JVX9kPM8m-7z1SkrtdKtJ",He="QLXkaPi43BFkwA7XAmatM",Be="_31DhKG5dZf0ks4ROrZ3qvh";var Ye=n(516),Xe=function(e){return(0,R.jsxs)("div",{className:"".concat(Ge," ").concat(e.className||""," ").concat(e.busy?Be:""),children:[(0,R.jsx)("img",{className:Qe,src:Ye.default}),(0,R.jsx)("input",{className:He,type:"text",value:e.text||"",onChange:e.onChange,onKeyDown:function(t){var n;"Enter"===t.key&&(null===(n=e.onSubmit)||void 0===n||n.call(e))},role:"search"})]})};const Je="_2BsgEMe1LEX0iJ7bgZata1",Ve="_3kURvWdSNN7HxQEbkY8d24",Ze="_201RsWi2Dy4UaSgMFpInMw",$e="_9TxdnNqBo5njSlnboTCt_",et="_1wt5p4j1mCgxzzx4wwqN8f";function tt(e){return function(e){if(Array.isArray(e))return nt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var rt=function(t){return(0,R.jsx)("div",{className:"btn-group",role:"group","aria-label":t["aria-label"],children:t.options.map((function(n){var r="".concat(t["aria-label"],"_").concat(n.value),o=t.value.includes(n.value);return(0,R.jsxs)(e.Fragment,{children:[(0,R.jsx)("input",{type:"checkbox",className:"btn-check",id:r,autoComplete:"off",checked:o,onChange:function(){var e,r;return o?null===(e=t.onChange)||void 0===e?void 0:e.call(t,t.value.filter((function(e){return e!==n.value}))):null===(r=t.onChange)||void 0===r?void 0:r.call(t,[].concat(tt(t.value),[n.value]))},role:"checkbox"}),(0,R.jsx)("label",{className:"btn btn-outline-primary",htmlFor:r,children:n.text})]},n.value)}))})},ot="SELECT_DEFAULT_VAL",at=e.memo((function(e){return(0,R.jsxs)("select",{className:"form-select","aria-label":e.ariaLabel,onChange:function(t){var n;return null===(n=e.onChange)||void 0===n?void 0:n.call(e,t.target.value)},value:e.value||ot,role:"listbox",children:[e.options.map((function(e){return(0,R.jsx)("option",{value:e.value,children:e.text},e.value)})),void 0===e.value?(0,R.jsx)("option",{value:ot,children:"Select"}):void 0]})}),(function(e,t){return e.value===t.value}));function it(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}at.displayName="Memoizied Select";var ct=d.deepFreeze(new function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),it(this,"24","24"),it(this,"32","32"),it(this,"64","64")});function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ut=function(e,t,n,r,o){var a="page-item\n    ".concat(t?"active":"","\n    ").concat(n?"disabled":""),i=n?void 0:r;return(0,R.jsx)("li",{className:a,onClick:i,children:(0,R.jsx)("a",{className:"page-link",href:"#",role:"number"==typeof e?"radio":"button",children:e})},o)},dt=function(t){var n,r,o=st(e.useState(void 0),2),a=o[0],i=o[1];if(e.useEffect((function(){i(void 0)}),[t.current]),!t.current)return(0,R.jsx)(R.Fragment,{});var c=Math.ceil((null!==(n=t.total)&&void 0!==n?n:999999)/(null!==(r=t.perPage)&&void 0!==r?r:1)),s=a||t.current,l=t.maxBtns,u=1===t.current,d=t.current===c,f=ut(1,u,t.disabled,(function(){var e;return null===(e=t.onChange)||void 0===e?void 0:e.call(t,1)}));l--;var h=ut(c,d,t.disabled,(function(){var e;return null===(e=t.onChange)||void 0===e?void 0:e.call(t,c)}));l--;var p=u||d?void 0:ut(s,s===t.current,t.disabled,(function(){var e;return null===(e=t.onChange)||void 0===e?void 0:e.call(t,s)}));p&&l--;var v=s-1>l/2?ut("...",!1,t.disabled,(function(){return i(Math.round(s/2))})):void 0,y=c-(s+1)>l/2?ut("...",!1,t.disabled,(function(){return i(Math.round((c-s)/2+s))})):void 0;v&&l--,y&&l--;for(var m=0,b=0,g=!1,j=!1;(!g||!j)&&0<l&&(s+b+1<c?(b++,l--):g=!0,l);)1<s-m-1?(m++,l--):j=!0;return(0,R.jsxs)("nav",{"aria-label":"Page navigation",style:{display:"grid",width:"100%",alignItems:"center",gridTemplateColumns:"1fr auto 1fr"},children:[(0,R.jsx)("div",{}),(0,R.jsxs)("ul",{className:"pagination",children:[ut("<",!1,t.disabled||u,(function(){var e;return null===(e=t.onChange)||void 0===e?void 0:e.call(t,t.current&&1<t.current?t.current-1:1)})),f,v,Array(m).fill(null).map((function(e,n){var r=s-m+n;return ut(r,r===t.current,t.disabled,(function(){var e;return null===(e=t.onChange)||void 0===e?void 0:e.call(t,r)}),ue())})),p,Array(b).fill(null).map((function(e,n){var r=s+1+n;return ut(r,r===t.current,t.disabled,(function(){var e;return null===(e=t.onChange)||void 0===e?void 0:e.call(t,r)}),ue())})),y,h,ut(">",!1,t.disabled||d,(function(){var e;return null===(e=t.onChange)||void 0===e?void 0:e.call(t,t.current&&t.current<c?t.current+1:c)}))]}),(0,R.jsx)("div",{style:{width:"fit-content",justifySelf:"end"},children:(0,R.jsx)(at,{value:"".concat(t.perPage)||"24",ariaLabel:"Set items per page",options:Object.keys(ct).map((function(e){return{value:e,text:e}})),onChange:function(e){var n;return null===(n=t.onPerPageChange)||void 0===n?void 0:n.call(t,Number.parseInt(e,10))}})})]})};function ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ht(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var pt=function(t){var n,r,o,a=ft(e.useState(!1),2),i=a[0],c=a[1];return(0,R.jsxs)("div",{className:Je,children:[(0,R.jsx)(Xe,{className:Ve,text:t.query.q,onChange:function(e){return t.onChange(e.target.value,"q")},onSubmit:function(){return t.onSubmit()},busy:t.busy}),(0,R.jsxs)("div",{className:Ze,children:[(0,R.jsxs)("div",{className:$e,children:[(0,R.jsxs)("div",{className:et,children:["Categories:",(0,R.jsx)(rt,{value:t.query.categories,"aria-label":"Categories checkbox toogle button group",options:Object.keys(h).map((function(e){return{value:e,text:e}})),onChange:function(e){return t.onChange(e,"categories")}})]}),(0,R.jsxs)("div",{className:et,children:["Purity:",(0,R.jsx)(rt,{value:t.query.purity,"aria-label":"Purity checkbox toogle button group",options:Object.keys(v).map((function(e){return{value:e,text:e}})),onChange:function(e){return t.onChange(e,"purity")}})]}),(0,R.jsxs)("label",{className:et,style:{fontSize:"var(--bs-body-font-size)"},children:["Sort by:",(0,R.jsx)(at,{value:t.query.sorting,ariaLabel:"Sorting select",onChange:function(e){return t.onChange(e,"sorting")},options:Object.keys(m).map((function(e){return{value:e,text:e}}))})]}),(0,R.jsxs)("label",{className:et,style:{fontSize:"var(--bs-body-font-size)"},children:["API key (is required to set items per page):",(0,R.jsx)("input",{className:"form-control",placeholder:"API key",value:t.query.apiKey||"",onChange:function(e){return t.onChange(e.target.value,"apiKey")}})]})]}),(0,R.jsx)(dt,{disabled:t.busy,current:null===(n=t.pagination)||void 0===n?void 0:n.current_page,total:null===(r=t.pagination)||void 0===r?void 0:r.total,perPage:Number.parseInt((null===(o=t.pagination)||void 0===o?void 0:o.per_page)||"24",10),onChange:function(e){return t.onChange(e,"page")},onPerPageChange:function(){return c(!0)},maxBtns:10}),i?(0,R.jsx)(de,{id:ue(),classNameStr:"animate__animated animate__fadeIn",ariaLabel:"Settings change error",title:"Settings change error",body:"Wallhaven API doesn't allow to change items per page! You can do this in your profile settings. DO NOT FORGET TO ENTER YOUR API KEY AFTER THAT!",btnText:"Go to settings",onClose:function(){return c(!1)},onOk:function(){c(!1);var e=document.createElement("a");e.href="https://wallhaven.cc/settings/account",e.target="_blank",e.referrerPolicy="noreferrer",e.click()}}):void 0]})]})};const vt="_2Yjl-1w1HRNhRwWvRQMLiP";var yt=(0,i.connect)((function(e){return{galleryState:e.galleryState}}),(function(e){return(0,a.bindActionCreators)({setQuery:se,Fetch:Ee,setContentScrollTop:_e,setApiKey:Te},e)}))((function(e){var t=e.galleryState,n=t.flags,r=t.dataMap,o=t.query,a=t.paginationData,i=t.contentScrollTop;return(0,R.jsxs)("section",{className:vt,children:[(0,R.jsx)(pt,{query:o,onChange:function(t,n){var r=ve(o,n,t);"apiKey"===n&&e.setApiKey(r.apiKey),e.setQuery(r),r.page!==o.page&&e.Fetch(!1,r)},onSubmit:function(){return e.Fetch(!1)},busy:n.fetching,pagination:a}),(0,R.jsx)(Ue,{memory:r,onScrollEnd:function(){return e.Fetch(!0)},end:n.end,error:n.error,fetching:n.fetching,searchPerformed:n.searchPerformed,scrollTop:i,onScroll:function(t){return e.setContentScrollTop(t)}})]})}));var mt={enter:oe,enterActive:ae,exit:ie,exitActive:ce},bt=function(){var e=(0,_.useLocation)();return(0,R.jsx)(T.SwitchTransition,{children:(0,R.jsx)(T.CSSTransition,{addEndListener:function(e,t){return e.addEventListener("transitionend",t,!1)},classNames:mt,children:(0,R.jsxs)(_.Switch,{location:e,children:[(0,R.jsx)(_.Route,{exact:!0,path:"/about",children:(0,R.jsx)(F,{})}),(0,R.jsx)(_.Route,{exact:!0,strict:!0,path:"/",children:(0,R.jsx)(yt,{})}),(0,R.jsx)(_.Route,{path:"/details/:id",children:(0,R.jsx)(ne,{})}),(0,R.jsx)(_.Route,{path:"*",children:(0,R.jsx)(q,{})})]})},e.pathname)})},gt=function(){return(0,R.jsxs)("div",{className:re,children:[(0,R.jsx)("header",{className:"container-fluid",children:(0,R.jsx)("nav",{children:(0,R.jsxs)("ul",{className:"nav nav-pills",children:[(0,R.jsx)("li",{className:"nav-item",children:(0,R.jsx)(_.NavLink,{exact:!0,strict:!0,className:"nav-link",to:"/",children:"Search"})}),(0,R.jsx)("li",{className:"nav-item",children:(0,R.jsx)(_.NavLink,{exact:!0,className:"nav-link",to:"/about",children:"About"})})]})})}),(0,R.jsx)(bt,{})]})};const jt=require("node-fetch");var xt=n.n(jt);var wt="https://wallhaven.cc/api/v1/",St=n(747),Ot=n(622),Pt=n(473),Nt=process.env.PORT||9e3,At=r(),Ct=Pt.json();At.get(/\.(js|css|map|ico|png|jpeg|jpg)$/,r.static(Ot.resolve(__dirname,"../client")));var Et=function(e){return new Promise((function(t,n){xt()("".concat(wt,"w/").concat(e.id).concat(e.apiKey?"?".concat(e.apiKey):"")).then((function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()})).then((function(e){return t(e.data)})).catch((function(e){return n(e)}))}))},_t=function(e){return new Promise((function(t,n){xt()("".concat(wt).concat(e.fetchStr)).then((function(e){if(200!==e.status)throw new Error(e.statusText);return e.json()})).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))};At.post("/proxy",Ct,(function(e,t){try{var n=e.body;switch(n.code){case L.WHWpInfo:return void function(e,t){Et(t).then((function(t){return e.status(200),e.send({data:t})})).catch((function(t){return console.error("Server encounter an error while fething one wallpaper: ".concat(t," ")),e.status(500),e.send()}))}(t,n);case L.WHSearch:return void function(e,t){_t(t).then((function(t){return e.status(200),e.send(t)})).catch((function(t){return console.error("Server encounter an error while fething one wallpaper: ".concat(t," ")),e.status(500),e.send()}))}(t,n);default:throw new Error}}catch(e){t.status(404),t.send("Unrecognizable proxy request")}})),At.use("*",(function(e,n){var r=St.readFileSync(Ot.resolve(__dirname,"../client/index.html"),{encoding:"utf8"}),c=(0,a.createStore)((function(e){return e}),{galleryState:j,detailsPageState:x,coreState:E}),s=t.renderToString((0,R.jsx)(i.Provider,{store:c,children:(0,R.jsx)(o.StaticRouter,{location:e.originalUrl,context:{},children:(0,R.jsx)(gt,{})})}));return r=r.replace('<div id="root"></div>','<div id="root">'.concat(s,"</div>")),n.contentType("text/html"),n.status(200),n.send(r)})),At.listen(Nt,(function(){console.log("Express server started at port ".concat(Nt))}))})()})();